# プロダクト概要

Codex History は、`~/.codex/sessions` に保存された Codex チャットの JSONL ログをローカルで安全に閲覧するビューアです。Rails 製 API がセッションファイルを取り込み正規化し、安全な HTML サニタイズを施したうえで、カレンダー型 UI が消費できる統一 JSON エンベロープとして提供します。

## 主要な能力

- `Sessions::Indexer` による増分インデックス化と、`Sessions::RefreshLauncher`・`Sessions::RefreshLock` によるリフレッシュジョブ管理。
- `Sessions::DetailBuilder` を介した正規化済みセッション詳細の提供と、サニタイズ版への自動フォールバック。
- `Search::KeywordSearcher` によるサニタイズ済みメッセージ断片のキーワード検索と文脈付きハイライト。
- クライアント間で成功・失敗処理を揃えるための統一 API エンベロープ（`data` / `meta` / `errors`）。
- `/api/sessions/refresh`・`/api/sessions/refresh/:job_id` によるリフレッシュ進捗トラッキング機能。

## 想定ユースケース

- 日付範囲や発話者ロールでセッションを絞り込み、目的の会話を迅速に見つける。
- ツール呼び出しメタデータや正規化メッセージを含む完全なトランスクリプトを参照して知識を再利用する。
- 生の JSONL を開かずに歴史的会話を横断検索し、コマンドやエラーメッセージ、キーワードを探し出す。
- サニタイズ版が危険なマークアップを除去していることを確認したうえで、第三者へ共有する。

## 提供価値

- プライベートな Codex ログを開発者のマシンに留めつつ、構造化 API 経由で安全に閲覧できるオフラインワークフロー。
- 正規化メッセージスキーマにより過去フォーマットとの差異を吸収し、UI をフォーマット変更から守る。
- サニタイズ済み HTML とサニタイズファイルのフォールバックによって、過去ログ表示時の XSS リスクを低減。
- Docker ベースのツール群と手順ドキュメントで、Rails・Node・周辺サービスの再現性あるセットアップを実現。

---
_包括的な機能一覧ではなく、パターンと目的に焦点を当てること_

_更新日: 2025-11-01_
